{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../produits/produit.service\";\nimport * as i2 from \"@angular/forms\";\nconst _c0 = [\"formulaireProduitRef\"];\nexport let ProduitsComponent = /*#__PURE__*/(() => {\n  class ProduitsComponent {\n    constructor(produitService, fb) {\n      this.produitService = produitService;\n      this.fb = fb;\n      this.produits = [];\n      this.afficherFormulaire = false;\n      this.produitEnEdition = null;\n      this.envoiEnCours = false;\n      // ðŸ”¥ BoÃ®te de dialogue de suppression\n      this.produitASupprimer = null;\n      this.formulaireProduit = this.fb.group({\n        nom: ['', Validators.required],\n        code: ['', Validators.required],\n        quantite: [1, [Validators.required, Validators.min(0)]],\n        prix: [null, [Validators.required, Validators.min(0)]],\n        date_expiration: ['', Validators.required]\n      });\n    }\n    ngOnInit() {\n      this.chargerProduits();\n    }\n    chargerProduits() {\n      this.produitService.getProduits().subscribe(data => {\n        this.produits = data;\n      });\n    }\n    get currentStatut() {\n      const quantite = this.formulaireProduit.get('quantite')?.value || 0;\n      if (quantite === 0) {\n        return {\n          text: 'Indisponible',\n          class: 'bg-red-100 text-red-800',\n          icon: 'ri-close-line text-red-600'\n        };\n      } else if (quantite <= 5) {\n        return {\n          text: 'Rupture',\n          class: 'bg-amber-100 text-amber-800',\n          icon: 'ri-alert-line text-amber-600'\n        };\n      } else {\n        return {\n          text: 'En stock',\n          class: 'bg-green-100 text-green-800',\n          icon: 'ri-check-line text-green-600'\n        };\n      }\n    }\n    ouvrirFormulaireAjout() {\n      this.produitEnEdition = null;\n      this.formulaireProduit.reset({\n        quantite: 1\n      });\n      this.afficherFormulaire = true;\n    }\n    commencerModification(produit) {\n      this.produitEnEdition = produit;\n      this.formulaireProduit.patchValue({\n        nom: produit.nom,\n        code: produit.code,\n        quantite: produit.quantite,\n        prix: produit.prix,\n        date_expiration: produit.date_expiration.split('T')[0] // Format pour input date\n      });\n\n      this.afficherFormulaire = true;\n      // ðŸ”½ Scroll vers le formulaire aprÃ¨s affichage\n      setTimeout(() => {\n        this.formulaireProduitElement?.nativeElement.scrollIntoView({\n          behavior: 'smooth'\n        });\n      }, 100);\n    }\n    onSubmit() {\n      if (this.formulaireProduit.invalid) return;\n      this.envoiEnCours = true;\n      const produitData = {\n        ...this.formulaireProduit.value,\n        statut: this.currentStatut.text\n      };\n      if (this.produitEnEdition) {\n        this.produitService.modifierProduit(this.produitEnEdition.id, produitData).subscribe({\n          next: produit => {\n            const index = this.produits.findIndex(p => p.id === produit.id);\n            if (index !== -1) this.produits[index] = produit;\n            this.fermerFormulaire();\n          },\n          error: err => console.error(err),\n          complete: () => this.envoiEnCours = false\n        });\n      } else {\n        this.produitService.ajouterProduit(produitData).subscribe({\n          next: produit => {\n            this.produits.unshift(produit);\n            this.fermerFormulaire();\n          },\n          error: err => console.error(err),\n          complete: () => this.envoiEnCours = false\n        });\n      }\n    }\n    // ðŸ†• Ouvre la boÃ®te de confirmation\n    demanderSuppression(produit) {\n      this.produitASupprimer = produit;\n    }\n    // ðŸ†• Annule la boÃ®te de confirmation\n    annulerSuppression() {\n      this.produitASupprimer = null;\n    }\n    // ðŸ†• Confirme et exÃ©cute la suppression\n    confirmerSuppression() {\n      if (this.produitASupprimer) {\n        this.produitService.supprimerProduit(this.produitASupprimer.id).subscribe({\n          next: () => {\n            this.produits = this.produits.filter(p => p.id !== this.produitASupprimer.id);\n            this.produitASupprimer = null;\n          },\n          error: err => console.error(err)\n        });\n      }\n    }\n    fermerFormulaire() {\n      this.afficherFormulaire = false;\n      this.produitEnEdition = null;\n      this.envoiEnCours = false;\n    }\n  }\n  ProduitsComponent.Éµfac = function ProduitsComponent_Factory(t) {\n    return new (t || ProduitsComponent)(i0.ÉµÉµdirectiveInject(i1.ProduitService), i0.ÉµÉµdirectiveInject(i2.FormBuilder));\n  };\n  ProduitsComponent.Éµcmp = /*@__PURE__*/i0.ÉµÉµdefineComponent({\n    type: ProduitsComponent,\n    selectors: [[\"app-produits\"]],\n    viewQuery: function ProduitsComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ÉµÉµviewQuery(_c0, 5);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ÉµÉµqueryRefresh(_t = i0.ÉµÉµloadQuery()) && (ctx.formulaireProduitElement = _t.first);\n      }\n    },\n    decls: 21,\n    vars: 0,\n    consts: [[1, \"bg-white\", \"p-6\", \"rounded-xl\", \"shadow-lg\", \"border\", \"border-gray-200\"], [1, \"text-xl\", \"font-semibold\", \"text-blue-600\", \"border-l-4\", \"border-blue-300\", \"pl-3\", \"mb-4\"], [1, \"overflow-x-auto\", \"rounded-lg\", \"border\", \"border-gray-200\"], [1, \"min-w-full\", \"bg-white\"], [1, \"bg-blue-100\", \"text-blue-700\"], [1, \"py-3\", \"px-5\", \"text-left\"]],\n    template: function ProduitsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ÉµÉµelementStart(0, \"div\", 0)(1, \"h4\", 1);\n        i0.ÉµÉµtext(2, \" Liste des produits \");\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(3, \"div\", 2)(4, \"table\", 3)(5, \"thead\", 4)(6, \"tr\")(7, \"th\", 5);\n        i0.ÉµÉµtext(8, \"Nom\");\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(9, \"th\", 5);\n        i0.ÉµÉµtext(10, \"Code\");\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(11, \"th\", 5);\n        i0.ÉµÉµtext(12, \"Quantit\\u00E9\");\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(13, \"th\", 5);\n        i0.ÉµÉµtext(14, \"Prix\");\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(15, \"th\", 5);\n        i0.ÉµÉµtext(16, \"Expiration\");\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(17, \"th\", 5);\n        i0.ÉµÉµtext(18, \"Statut\");\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(19, \"th\", 5);\n        i0.ÉµÉµtext(20, \"Actions\");\n        i0.ÉµÉµelementEnd()()()()()();\n      }\n    },\n    encapsulation: 2\n  });\n  return ProduitsComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}